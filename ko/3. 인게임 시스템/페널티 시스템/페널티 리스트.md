# 페널티 시스템 - 페널티 리스트

## 개요
메토체스의 페널티 시스템은 4개 레벨 총 46개의 다양한 페널티를 제공합니다. 각 페널티는 게임의 특정 측면을 제약하거나 적을 강화하여 점진적인 난이도 상승을 구현합니다.

## 레벨별 페널티 분류

### Level 0: 기본 제약 페널티 (PEN00XXX)

기본적인 게임 시스템 제약을 가하는 입문 단계 페널티들입니다.

#### PEN00001: 라운드 패배 보상 삭제
- **효과**: 라운드 패배 시 받는 5코인 추가 보상 제거
- **영향**: 경제적 완충장치 제거로 패배 비용 증가

#### PEN00002: 룬카드 판매/파괴 불가 태그
- **효과**: 룬카드 상점 등장 시 30% 확률로 '판매 불가 및 파괴 불가' 태그 부여
- **영향**: 룬카드 관리의 유연성 감소

#### PEN00003: 룸카드 소각 태그
- **효과**: 룬카드 상점 등장 시 30% 확률로 '5라운드 뒤 소각' 태그 부여
- **영향**: 룬카드의 지속성 제한

### Level 1: 적 스탯 강화 페널티 (PEN1XXXX)

모든 적 유닛의 기본 스탯을 강화하는 직접적인 난이도 상승 페널티들입니다.

#### 공격 관련 강화
- **PEN10001**: 모든 적의 공격력 +15%
- **PEN10002**: 모든 적의 마력 +15%
- **PEN10005**: 모든 적의 공격 속도 +15%
- **PEN10006**: 모든 적의 크리티컬 확률 +30%

#### 방어 관련 강화
- **PEN10003**: 모든 적의 물리 방어력 +30
- **PEN10004**: 모든 적의 마법 방어력 +30
- **PEN10008**: 모든 적의 최대 체력 +225

#### 스킬 관련 강화
- **PEN10007**: 모든 적의 시작 MP +22

### 구현 패턴 예시
```lua
-- PEN10001: 공격력 15% 증가
for _, unit in pairs(teamManager.EnemyUnits) do
    if unit.UnitAIWanderComponent.Enable then
        _StatusChangeLogic:GetBuff(unit, "Multi_PhysicalAttack", 15, -1)
    end
end
```

### Level 2: 시스템 제약 및 추가 적 (PEN2XXXX)

게임 시스템 자체를 제약하거나 특별한 조건을 추가하는 중급 페널티들입니다.

#### 상점 시스템 제약
- **PEN20001**: 룬카드 상점에서 레전더리 등급 미등장 (코치 효과 제외)
- **PEN20002**: 모든 아이템 상자 선택지 수 1 감소

#### 추가 적 소환
- **PEN20003**: 적 팀에 허수아비 1마리 추가
  - 스테이지에 비례해 점점 강해짐
  - 탱커 아이템 자동 장착 시스템

```lua
-- 허수아비 소환 및 강화
self.SetUnit = _UnitSetLogic_New:SpawnEnemyUnit(ownerId, "C00000", 
    math.floor((gameManager.Stage + 2) / 3), 0)
gameManager.EnemyCount += 1

-- 스테이지별 아이템 장착
if gameManager.Stage > 2 then
    for i = 1, math.floor((gameManager.Stage-1) / 2) do
        _ItemSetLogic:EquipItemThroughItemID(self.SetUnit, nItemTable[i])
    end
end
```

#### 경제 시스템 변경
- **PEN20004**: 모든 적의 공격 사거리 +1
- **PEN20005**: 이자 획득 불가, 대신 승리 시 생존 아군 수 비례 보상 100% 증가
- **PEN20006**: 라운드 패배 시 5코인 추가 보상 삭제

#### 강제 룬카드 시스템 (PEN20007~PEN20016)
특정 룬카드를 파괴/판매 불가 상태로 강제 보유하게 하는 페널티들:

- **PEN20007**: 세피 룬카드 (RC10034)
- **PEN20008**: 어린 륀느 룬카드
- **PEN20009**: 선더 룬카드
- **PEN20010**: 떠돌이 연금술사 룬카드
- **PEN20011**: 크리슈라마 룬카드
- **PEN20012**: 골드리치 주니어 룬카드
- **PEN20013**: 덴마 룬카드
- **PEN20014**: 루티 룬카드
- **PEN20015**: 위즈 룬카드
- **PEN20016**: 프레드릭 룬카드

### Level 3: 비용 증가 및 슬롯 제한 (PEN3XXXX)

게임 내 각종 행동의 비용을 증가시키거나 슬롯을 제한하는 고급 페널티들입니다.

#### 상점 비용 증가
- **PEN30001**: 캐릭터 상점 새로고침 비용 +1 (`Reroll_Cost += 1`)
- **PEN30002**: 경험치 구매 비용 +1
- **PEN30003**: 룬 상점 새로고침 비용 +2 (`RuneReroll_Cost += 2`)

#### 슬롯 제한 시스템
- **PEN30004~PEN30015**: 다양한 슬롯 수 제한
- **PEN30016**: 특별 페널티 - 전투 중 주기적 적 은신

### Level 4: 극한 제약 (PEN4XXXX)

최고 난이도의 극한 페널티입니다.

#### PEN40001: 극한 적 강화
- **효과**: 모든 적의 가해량 +40%, 피해량 -40%
- **특징**: 라운드와 스테이지에 비례한 동적 스택 시스템

```lua
local penaltyStack = gameManager.Round + (gameManager.Stage - 1) * 3
_StatusChangeLogic:GetBuff(unit, "Add_DealingDamageRate", 2 * penaltyStack, -1)
_StatusChangeLogic:GetBuff(unit, "DamageDecrease_Per", 2 * penaltyStack, -1)
```

## 페널티 구현 기술 요소

### 공통 구현 패턴
```lua
@Component
script PEN[XXXXX] extends PenaltyComponent
    method void [Event]Handler(any event)
        __base:[Event]Handler(event)
        -- 페널티별 로직 구현
```

### 주요 구현 메서드
- `StartGameHandler()`: 게임 시작 시 기본 설정 변경
- `StartBattleHandler()`: 전투 시작 시 임시 효과 적용
- `SetBattleHandler()`: 전투 설정 단계에서 적 소환 등

### 핵심 시스템 활용

#### 스탯 변경 시스템
```lua
_StatusChangeLogic:GetBuff(unit, "Multi_PhysicalAttack", percent, duration)
_StatusChangeLogic:SetStatus(unit, caster, "SE0002", duration) -- 은신
```

#### 프로퍼티 제어 시스템
```lua
userPControl.Reroll_Cost += 1 -- 상점 비용 증가
userPControl.Rune_UseRuneSlotCount -= 1 -- 룬카드 슬롯 감소
```

#### 룬카드 관리 시스템
```lua
specialShopManager:GetRuneCard_Check(runeID) -- 룬카드 지급
rcCompo:SetIsDestructible(false) -- 파괴 불가 설정
```

#### 타이머 시스템
```lua
timer = _TimerService:SetTimerRepeat(function, interval, delay)
_TimerService:ClearTimer(timer)
```

## 페널티 카테고리별 전략적 영향

### 경제 압박 페널티
- 패배 보상 제거, 비용 증가
- 자원 관리의 중요성 증대
- 안정적 운영 전략 필요

### 적 강화 페널티
- 직접적인 전투력 차이
- 더 강한 조합과 시너지 필요
- 아이템과 레벨업의 중요성 증대

### 시스템 제약 페널티
- 게임 플레이 패턴 변경 강요
- 창의적 해결책 필요
- 적응력과 유연성 중요

### 슬롯 제한 페널티
- 선택의 폭 제한
- 효율적 자원 활용 필요
- 최적화된 빌드 중요

## Code References
- `RootDesk/MyDesk/InGame/Penalty/List/PEN10001.mlua :: StartBattleHandler()` — 적 공격력 15% 증가
- `RootDesk/MyDesk/InGame/Penalty/List/PEN20003.mlua :: SetBattleHandler()` — 허수아비 소환 및 아이템 장착
- `RootDesk/MyDesk/InGame/Penalty/List/PEN20007.mlua :: StartGameHandler()` — 강제 룬카드 지급 및 파괴 불가 설정
- `RootDesk/MyDesk/InGame/Penalty/List/PEN30001.mlua :: StartGameHandler()` — 상점 비용 증가
- `RootDesk/MyDesk/InGame/Penalty/List/PEN30016.mlua :: StartBattleHandler()` — 주기적 적 은신 시스템
- `RootDesk/MyDesk/InGame/Penalty/List/PEN40001.mlua :: StartBattleHandler()` — 동적 스택 기반 극한 적 강화

## 특징 및 디자인 철학

1. **점진적 난이도**: Level 0부터 4까지 체계적인 난이도 상승
2. **다양성**: 경제, 전투, 시스템 제약 등 다각도 접근
3. **전략적 깊이**: 각 페널티가 다른 대응 전략 요구
4. **기술적 우수성**: 이벤트 기반의 깔끔한 구현
5. **동적 시스템**: 게임 진행에 따른 페널티 강화
6. **균형성**: 극복 불가능하지 않은 적절한 제약 수준

페널티 시스템은 메토체스에서 지속적인 도전과 성장을 제공하는 핵심 메커니즘으로, 플레이어가 더 높은 레벨에서 새로운 전략을 개발하고 적응할 수 있도록 도와줍니다.
